openapi: 3.0.0
info:
  title: "Tenant Portal APIs"
  description: Tenant API POC
  version: 1.0.1
x-amazon-apigateway-request-validators:
  all:
    validateRequestBody: true
x-amazon-apigateway-request-validator: all
paths:
  
# ---------- Teams Management APIs ----------

  /v2/teams:
    get:
      summary: List all teams for the current user
      description: Returns all teams the user is a member of, including their role and current team status
      produces:
        - application/json
      parameters:
        - name: currentTeam
          in: query
          description: ID of the team the user is currently logged into
          required: false
          type: string
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListUserTeamsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []
    post:
      summary: Create a new team
      description: Creates a new team with the requesting user as the admin
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateTeamLambda.Arn}/invocations
        responses:
          default:
            statusCode: "201"
      security:
        - UserPool: []

  /v2/teams/{teamId}:
    get:
      summary: Get team details
      description: Returns detailed information about a specific team
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamOperationsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  /v2/teams/{teamId}/status:
    patch:
      summary: Update team status
      description: Activate or deactivate a team (admin only)
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamOperationsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  /v2/teams/{teamId}/members:
    get:
      summary: Get team members
      description: Returns all members of a team with their roles
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamOperationsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []
    post:
      summary: Add members to team
      description: Add new members to a team (admin only)
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamOperationsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  /v2/teams/{teamId}/members/{username}/role:
    post:
      summary: Update member role
      description: Update a team member's role to ADMIN or MEMBER (admin only)
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
        - name: username
          in: path
          description: Username of the member
          required: true
          type: string
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamOperationsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  /v2/user/current-team:
    patch:
      summary: Set current team
      description: Update the user's currently logged-in team. User must be a member of the team.
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${SetCurrentTeamLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  # ---------- Team Attributes APIs (Skills, Values, Milestones, Metrics) ----------

  /v2/teams/{teamId}/attributes:
    get:
      summary: List team attributes
      description: Get all attributes (skills, values, milestones, metrics) for a specific team. All team members can access.
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
        - name: type
          in: query
          description: Filter by attribute type (SKILL, VALUE, MILESTONE, METRIC)
          required: false
          type: string
          enum:
            - SKILL
            - VALUE
            - MILESTONE
            - METRIC
      responses:
        200:
          description: Successful response
          schema:
            type: object
            properties:
              teamId:
                type: string
                description: Team ID
              attributes:
                type: object
                properties:
                  skills:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamAttribute'
                  values:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamAttribute'
                  milestones:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamAttribute'
                  metrics:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamAttribute'
              total:
                type: integer
                description: Total number of attributes
        403:
          description: User is not a member of this team
        404:
          description: Team not found
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamAttributesLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

    post:
      summary: Create custom team attribute
      description: Create a new custom attribute for a team. Only team admins can create attributes.
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            type: object
            required:
              - attributeType
              - name
            properties:
              attributeType:
                type: string
                enum:
                  - SKILL
                  - VALUE
                  - MILESTONE
                  - METRIC
                description: Type of attribute to create
              name:
                type: string
                description: Name of the attribute
                maxLength: 100
              description:
                type: string
                description: Description of the attribute
                maxLength: 500
      responses:
        201:
          description: Attribute created successfully
          schema:
            type: object
            properties:
              message:
                type: string
              attribute:
                $ref: '#/components/schemas/TeamAttribute'
        400:
          description: Invalid request body or attribute type
        403:
          description: Only team admins can create attributes
        404:
          description: Team not found
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamAttributesLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  /v2/teams/{teamId}/attributes/{attributeId}:
    patch:
      summary: Update custom team attribute
      description: Update an existing custom attribute for a team. Only team admins can update attributes. Default attributes cannot be updated.
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
        - name: attributeId
          in: path
          description: Attribute ID to update
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              name:
                type: string
                description: Updated name of the attribute
                maxLength: 100
              description:
                type: string
                description: Updated description of the attribute
                maxLength: 500
            minProperties: 1
            additionalProperties: false
      responses:
        200:
          description: Attribute updated successfully
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Attribute updated successfully"
              attribute:
                $ref: '#/components/schemas/TeamAttribute'
        400:
          description: Invalid request body or no fields provided
          schema:
            type: object
            properties:
              error:
                type: string
                example: "At least one field (name or description) must be provided for update"
        403:
          description: Only team admins can update attributes
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Only team admins can update custom attributes"
        404:
          description: Attribute or team not found
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Attribute not found"
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamAttributesLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

    delete:
      summary: Delete custom team attribute
      description: Delete a custom attribute from a team. Only team admins can delete attributes. Default attributes cannot be deleted.
      produces:
        - application/json
      parameters:
        - name: teamId
          in: path
          description: Team ID
          required: true
          type: string
        - name: attributeId
          in: path
          description: Attribute ID to delete
          required: true
          type: string
      responses:
        200:
          description: Attribute deleted successfully
          schema:
            type: object
            properties:
              message:
                type: string
                example: "Attribute deleted successfully"
              attributeId:
                type: string
                example: "ATTR-123e4567-e89b-12d3-a456-426614174000"
              deletedBy:
                type: string
                example: "john.doe"
        403:
          description: Only team admins can delete attributes
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Only team admins can delete custom attributes"
        404:
          description: Attribute or team not found
          schema:
            type: object
            properties:
              error:
                type: string
                example: "Attribute not found"
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageTeamAttributesLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  # ---------- Employee Profile V2 APIs ----------

  /v2/profile:
    options:
      summary: CORS preflight request
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageEmployeeProfileV2Lambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
    get:
      summary: Get user profile information
      description: Returns basic profile information for the authenticated user
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageEmployeeProfileV2Lambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []
    patch:
      summary: Update user profile information
      description: Update phone number, designation, display name, and/or profile picture
      consumes:
        - application/json
      produces:
        - application/json
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                PhoneNumber:
                  type: string
                  description: User's phone number
                  example: "+1234567890"
                Designation:
                  type: string
                  description: User's job title or designation
                  example: "Senior Developer"
                DisplayName:
                  type: string
                  description: User's display name (updates both DDB and Cognito)
                  example: "John Doe"
                ProfilePic:
                  type: string
                  description: Base64 encoded profile picture
                  example: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg=="
            examples:
              update_phone:
                summary: Update phone number only
                value:
                  PhoneNumber: "+1234567890"
              update_all:
                summary: Update multiple fields
                value:
                  PhoneNumber: "+1234567890"
                  Designation: "Senior Developer"
                  DisplayName: "John Doe"
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageEmployeeProfileV2Lambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
      security:
        - UserPool: []

  # --------------- Organization Management Endpoints ---------------
  
  /v2/organization:
    options:
      summary: CORS support
      description: Enable CORS by returning correct headers
      consumes:
        - application/json
      produces:
        - application/json
      tags:
        - CORS
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: |
            {
              "statusCode" : 200
            }
        responses:
          "200":
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key'"
              method.response.header.Access-Control-Allow-Methods: "'*'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
            responseTemplates:
              application/json: |
                {}
      responses:
        "200":
          description: Default response for CORS method
          headers:
            Access-Control-Allow-Headers:
              type: "string"
            Access-Control-Allow-Methods:
              type: "string"
            Access-Control-Allow-Origin:
              type: "string"
    post:
      summary: Create Organization
      description: Create a new organization with client and industry-specific details
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${CreateOrganizationLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []

  /v2/organization/{organizationId}:
    options:
      summary: CORS support
      description: Enable CORS by returning correct headers
      consumes:
        - application/json
      produces:
        - application/json
      tags:
        - CORS
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: |
            {
              "statusCode" : 200
            }
        responses:
          "200":
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key'"
              method.response.header.Access-Control-Allow-Methods: "'*'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
            responseTemplates:
              application/json: |
                {}
      responses:
        "200":
          description: Default response for CORS method
          headers:
            Access-Control-Allow-Headers:
              type: "string"
            Access-Control-Allow-Methods:
              type: "string"
            Access-Control-Allow-Origin:
              type: "string"
    get:
      summary: Get Organization Details
      description: Retrieve comprehensive organization information including client details and subscription status
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageOrganizationLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []
    put:
      summary: Update Organization
      description: Update organization details including client information and industry-specific data
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageOrganizationLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []

  /v2/organization/list:
    options:
      summary: CORS support
      description: Enable CORS by returning correct headers
      consumes:
        - application/json
      produces:
        - application/json
      tags:
        - CORS
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: |
            {
              "statusCode" : 200
            }
        responses:
          "200":
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key'"
              method.response.header.Access-Control-Allow-Methods: "'*'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
            responseTemplates:
              application/json: |
                {}
      responses:
        "200":
          description: Default response for CORS method
          headers:
            Access-Control-Allow-Headers:
              type: "string"
            Access-Control-Allow-Methods:
              type: "string"
            Access-Control-Allow-Origin:
              type: "string"
    get:
      summary: List User Organizations
      description: List all organizations where the authenticated user is an admin
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ListUserOrganizationsLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []

  /v2/organization/{organizationId}/subscription:
    options:
      summary: CORS support
      description: Enable CORS by returning correct headers
      consumes:
        - application/json
      produces:
        - application/json
      tags:
        - CORS
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: |
            {
              "statusCode" : 200
            }
        responses:
          "200":
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key'"
              method.response.header.Access-Control-Allow-Methods: "'*'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
            responseTemplates:
              application/json: |
                {}
      responses:
        "200":
          description: Default response for CORS method
          headers:
            Access-Control-Allow-Headers:
              type: "string"
            Access-Control-Allow-Methods:
              type: "string"
            Access-Control-Allow-Origin:
              type: "string"
    get:
      summary: Get Subscription Plans
      description: Retrieve available subscription plans with pricing and feature comparison
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageSubscriptionLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []
    put:
      summary: Update Subscription
      description: Switch between subscription plans and update billing cycle
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManageSubscriptionLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []

  /v2/organization/{organizationId}/promo-code:
    options:
      summary: CORS support
      description: Enable CORS by returning correct headers
      consumes:
        - application/json
      produces:
        - application/json
      tags:
        - CORS
      x-amazon-apigateway-integration:
        type: mock
        requestTemplates:
          application/json: |
            {
              "statusCode" : 200
            }
        responses:
          "200":
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key'"
              method.response.header.Access-Control-Allow-Methods: "'*'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
            responseTemplates:
              application/json: |
                {}
      responses:
        "200":
          description: Default response for CORS method
          headers:
            Access-Control-Allow-Headers:
              type: "string"
            Access-Control-Allow-Methods:
              type: "string"
            Access-Control-Allow-Origin:
              type: "string"
    post:
      summary: Apply Promo Code
      description: Apply promotional codes for percentage discounts or free trial periods
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManagePromoCodesLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []
    get:
      summary: Get Active Promo Code Details
      description: Get details of currently active promo code for the organization
      consumes:
        - application/json
      produces:
        - application/json
      x-amazon-apigateway-integration:
        type: AWS_PROXY
        httpMethod: POST
        passthroughBehavior: WHEN_NO_MATCH
        uri:
          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ManagePromoCodesLambda.Arn}/invocations
        responses:
          default:
            statusCode: "200"
            responseParameters:
              method.response.header.Access-Control-Allow-Origin: "'*'"
      responses:
        "200":
          description: Successful response
          headers:
            Access-Control-Allow-Origin:
              type: "string"
      security:
        - UserPool: []

components:
  schemas:
    Tenantrequestbody:
      description: Tenant request body of POST API
      type: object
      properties:
        TenantInput1:
          type: string
          description: Tenant description of input1
        TenantInput2:
          type: string
          description: Tenant description of input2
    Tenantresponse:
      description: Tenant response of the API
      type: object
      properties:
        TenantRequiredField:
          type: string
          description: Tenant description of TenantRequiredField
        field2:
          type: string
        field3:
          type: object
    TeamAttribute:
      description: Team attribute schema (skills, values, milestones, metrics)
      type: object
      properties:
        attributeId:
          type: string
          description: Unique identifier for the attribute (format ATTR-{uuid})
          example: "ATTR-123e4567-e89b-12d3-a456-426614174000"
        teamId:
          type: string
          description: Team identifier (format TEAM-{id})
          example: "TEAM-abc123"
        attributeType:
          type: string
          enum:
            - SKILL
            - VALUE
            - MILESTONE
            - METRIC
          description: Type of attribute
          example: "SKILL"
        name:
          type: string
          description: Display name of the attribute
          maxLength: 100
          example: "Leadership"
        description:
          type: string
          description: Detailed description of the attribute
          maxLength: 500
          example: "Demonstrated ability to lead and inspire team members"
        isDefault:
          type: boolean
          description: Whether this is a system-created default attribute
          example: true
        createdAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp of creation
          example: "2026-01-15T10:00:00Z"
        createdBy:
          type: string
          description: Username of the creator
          example: "john.doe"
        updatedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp of last update
          example: "2026-01-15T10:00:00Z"
    errorbody:
      type: object
      properties:
        errorText:
          type: string

    # --------------- Organization Management Schemas ---------------
    
    CreateOrganizationRequest:
      type: object
      required:
        - organizationName
        - subscriptionPlan
        - billingCycle
      properties:
        organizationName:
          type: string
          minLength: 3
          maxLength: 100
          description: Official organization name
        displayName:
          type: string
          maxLength: 50
          description: Display name for the organization
        industry:
          type: string
          maxLength: 50
          description: Industry category
        description:
          type: string
          maxLength: 500
          description: Organization description
        clientDetails:
          $ref: '#/components/schemas/ClientDetails'
        subscriptionPlan:
          type: string
          enum: [BASIC, PROFESSIONAL, ENTERPRISE]
          description: Initial subscription plan
        billingCycle:
          type: string
          enum: [MONTHLY, YEARLY]
          description: Billing cycle preference

    ClientDetails:
      type: object
      properties:
        companySize:
          type: string
          enum: ["1-10", "11-50", "51-200", "201-1000", "1000+"]
          description: Number of employees
        headquarters:
          type: string
          maxLength: 100
          description: Primary business location
        website:
          type: string
          format: uri
          description: Company website URL
        primaryContact:
          $ref: '#/components/schemas/ContactInfo'
        businessType:
          type: string
          enum: [B2B, B2C, B2B2C]
          description: Business model type
        annualRevenue:
          type: string
          enum: ["<$1M", "$1M-10M", "$10M-50M", "$50M-100M", "$100M+"]
          description: Annual revenue range

    ContactInfo:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
        phone:
          type: string
          maxLength: 20

    UpdateOrganizationRequest:
      type: object
      properties:
        displayName:
          type: string
          maxLength: 50
        industry:
          type: string
          maxLength: 50
        description:
          type: string
          maxLength: 500
        clientDetails:
          $ref: '#/components/schemas/ClientDetails'

    CreateOrganizationResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        organizationId:
          type: string
          description: Unique identifier for the created organization
        data:
          $ref: '#/components/schemas/OrganizationResponse'

    OrganizationResponse:
      type: object
      properties:
        organizationId:
          type: string
        organizationName:
          type: string
        displayName:
          type: string
        industry:
          type: string
        description:
          type: string
        clientDetails:
          $ref: '#/components/schemas/ClientDetails'
        planType:
          type: string
          enum: [BASIC, PROFESSIONAL, ENTERPRISE]
        billingCycle:
          type: string
          enum: [MONTHLY, YEARLY]
        teamLimit:
          type: integer
          description: Maximum teams allowed
        currentTeamCount:
          type: integer
          description: Current number of teams
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time
        admins:
          type: array
          items:
            type: string
          description: List of admin user IDs
        activePromoCode:
          type: string
          nullable: true
          description: Currently active promo code

    OrganizationListResponse:
      type: object
      properties:
        success:
          type: boolean
        organizations:
          type: array
          items:
            $ref: '#/components/schemas/OrganizationSummary'

    OrganizationSummary:
      type: object
      properties:
        organizationId:
          type: string
        organizationName:
          type: string
        displayName:
          type: string
        industry:
          type: string
        planType:
          type: string
        currentTeamCount:
          type: integer
        teamLimit:
          type: integer
        isActive:
          type: boolean
        role:
          type: string
          enum: [ADMIN]
          description: User's role in the organization

    SubscriptionPlansResponse:
      type: object
      properties:
        success:
          type: boolean
        currentPlan:
          $ref: '#/components/schemas/SubscriptionDetails'
        availablePlans:
          type: array
          items:
            $ref: '#/components/schemas/SubscriptionPlan'

    SubscriptionDetails:
      type: object
      properties:
        planType:
          type: string
        billingCycle:
          type: string
        price:
          type: number
        teamLimit:
          type: integer
        isActive:
          type: boolean
        nextBillingDate:
          type: string
          format: date-time

    SubscriptionPlan:
      type: object
      properties:
        planType:
          type: string
          enum: [BASIC, PROFESSIONAL, ENTERPRISE]
        features:
          type: array
          items:
            type: string
        teamLimit:
          type: integer
        pricing:
          type: object
          properties:
            monthly:
              type: number
            yearly:
              type: number
            yearlyDiscount:
              type: number
              description: Percentage discount for yearly billing

    UpdateSubscriptionRequest:
      type: object
      required:
        - planType
        - billingCycle
      properties:
        planType:
          type: string
          enum: [BASIC, PROFESSIONAL, ENTERPRISE]
        billingCycle:
          type: string
          enum: [MONTHLY, YEARLY]

    SubscriptionResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        subscription:
          $ref: '#/components/schemas/SubscriptionDetails'

    ApplyPromoCodeRequest:
      type: object
      required:
        - promoCode
      properties:
        promoCode:
          type: string
          minLength: 3
          maxLength: 20
          description: Promotional code to apply

    PromoCodeResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        promoDetails:
          type: object
          properties:
            promoCode:
              type: string
            discountType:
              type: string
              enum: [PERCENTAGE, FREE_TRIAL]
            discountValue:
              type: number
              description: Percentage off or trial days
            description:
              type: string
            expiresAt:
              type: string
              format: date-time
            isActive:
              type: boolean

    OrganizationErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message

securityDefinitions:
  UserPool:
    type: "apiKey"
    name: "Authorization"
    in: "header"
    x-amazon-apigateway-authtype: "cognito_user_pools"
    x-amazon-apigateway-authorizer:
      type: "cognito_user_pools"
      providerARNs:
        - Fn::Sub: arn:aws:cognito-idp:${AWS::Region}:${AWS::AccountId}:userpool/${TenantCognitoUserPool}
